<!-- Head -->
	<%- include('partials/head') -%>

<!-- Header -->
	<%- include('partials/header') -%>

<!-- Menu -->
	<%- include('partials/nav') -%>

<!-- Main -->
	<article id="main">
		<div class="wrapper">
			<div class="inner">
				<!-- Banner -->
					<h2 id="elements" class="centerElement">As Author</h2>
					<div class="row gtr-200">
						<div class="col-6 col-12-small">
							<a href="/papers/submit" class="button primary large">Submit A Paper</a>
						</div>
						<div class="col-6 col-12-small">
							<h2 class="right-small-fade">Branding</h2>
						</div>
					</div>
					<hr class="major" />
				<!-- Documents in Progress -->
					<h4>In Progress</h4>
					<div class="table-wrapper">
						<table class="vertical-border">
							<thead>
								<tr>
									<th>Manuscript Number</th>
									<th>Title</th>
									<th>Date Submitted</th>
									<th>Status</th>
									<th>Review Number</th>
									<th>Review Accepted</th>
									<th>Reviewer ID#</th>
								</tr>
							</thead>
							<tbody>
								<% for(let i=0; i<papersInProgress.length; i++) {%>
									<% if(papersInProgress[i].reviews.length) { %>
										<% for(let j=0; j<papersInProgress[i].reviewsRequested; j++) { %>
											<% if(!papersInProgress[i].reviews[j] || !papersInProgress[i].reviews[j].document) { %>
												<tr>
													<td><%= papersInProgress[i].manuscriptNumber %></td>
													<td><a href="<%= papersInProgress[i].document %>" target="_blank"><%= papersInProgress[i].title %></a></td>
													<td><%= papersInProgress[i].createdAt.toLocaleDateString('en-us') %></td>
													<% if(j < papersInProgress[i].reviews.length) { %>
														<% let reviewAccepted = new Date(papersInProgress[i].reviews[j].reviewAccepted) %>
														<td><%= papersInProgress[i].status %></td>
														<td><%= `${j + 1} / ${papersInProgress[i].reviewsRequested}` %></td>
														<td><%= reviewAccepted ? reviewAccepted.toLocaleDateString('en-us') : '' %></td>
														<td><%= papersInProgress[i].reviews[j].reviewerID ? papersInProgress[i].reviews[j].reviewerID : '' %></td>
													<% } else {%>
														<td>Awaiting Reviewer</td>
														<td><%= `${j + 1} / ${papersInProgress[i].reviewsRequested}` %></td>
														<td></td>
														<td></td>
													<% } %>
												</tr>
											<% } %>
										<% } %>
									<% } else { %>
										<tr>
											<td><%= papersInProgress[i].manuscriptNumber %></td>
											<td><a href="<%= papersInProgress[i].document %>" target="_blank"><%= papersInProgress[i].title %></a></td>
											<td><%= papersInProgress[i].createdAt.toLocaleDateString('en-us') %></td>
											<td><%= papersInProgress[i].status %></td>
											<td></td>
											<td></td>
											<td></td>
										</tr>
									<% } %>
								<% } %>
							</tbody>
						</table>
					</div>
				<!-- Completed Reviews -->
					<h4>Completed Reviews</h4>
					<div class="table-wrapper">
						<table class="vertical-border">
							<thead>
								<tr>
									<th>Manuscript Number</th>
									<th>Article Title</th>
									<th>Review Number</th>
									<th>Submitted</th>
									<th>Reviewed</th>
									<th>Time of Review</th>
									<th>Review</th>
									<th>Reviewer ID#</th>
									<th>Reviewer's Rating</th>
									<th>Author Rates Review</th>
								</tr>
							</thead>
							<tbody>
								<% let numberOfReviews = 0 %>
								<% for(var i=0; i<papersReviewed.length; i++) {%>
									<% for(var j=0; j<papersReviewed[i].reviews.length; j++) {%>
										<% if(papersReviewed[i].reviews[j].reviewCompleted) {%>
											<% numberOfReviews++ %>
											<% let reviewAccepted = new Date(papersReviewed[i].reviews[j].reviewAccepted) %>
											<% let reviewCompleted = new Date(papersReviewed[i].reviews[j].reviewCompleted) %>
											<tr>
												<td><%= papersReviewed[i].manuscriptNumber %></td>
												<td><a href="<%= papersReviewed[i].reviews[j].document %>"><%= papersReviewed[i].title %></a></td>
												<td><%= `${j + 1} / ${papersReviewed[i].reviewsRequested}` %></td>
												<td><%= papersReviewed[i].createdAt.toLocaleDateString('en-us') %></td>
												<td><%= reviewAccepted.toLocaleDateString('en-us') %></td>
												<td><%= Math.floor((reviewAccepted - reviewCompleted) / (-1000 * 60 * 60 * 24)) %> day(s)</td>
												<td><a href="<%= papersReviewed[i].reviews[j].document %>" target="_blank">Review</a></td>
												<td><%= papersReviewed[i].reviews[j].reviewerID %></td>
												<td>To Do</td>
												<td>To Do</td>
											</tr>
										<% } %>
									<% } %>
								<% } %>
							</tbody>
						</table>
					</div>
				</div>
				<!-- Life Time Stats -->
				<h4>Lifetime Stats</h4>
				<div class="table-wrapper">
					<table class="vertical-border">
						<thead>
							<tr>
								<th>Paper Submitted</th>
								<th>Reviews Received</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td><%= submitted %></td>
								<td><%= numberOfReviews %></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
	</article>

<!-- Footer -->
	<%- include('partials/footer') -%>

<!-- Scripts & Close -->
	<%- include('partials/scripts') -%>
